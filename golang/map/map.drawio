<mxfile host="app.diagrams.net" modified="2022-07-21T10:45:19.380Z" agent="5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/103.0.0.0 Safari/537.36" etag="xUr15t98OaQyTftftIww" version="20.1.4" type="github">
  <diagram id="-t0L7R9dtZqjnDYoFO7W" name="map">
    <mxGraphModel dx="2582" dy="918" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="827" pageHeight="1169" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="uL5SlHfGoZUMoFEmo-0I-1" value="&lt;ul style=&quot;font-family: Helvetica;&quot;&gt;&lt;li&gt;&lt;font face=&quot;Lucida Console&quot;&gt;count指示当前map中总共有多少个元素&lt;/font&gt;&lt;/li&gt;&lt;li&gt;&lt;font face=&quot;Lucida Console&quot;&gt;flags记录当前map的状态，指示当前map是否正在写;是否使用同样的size进行扩容;是否有迭代器正在进行迭代操作等&lt;/font&gt;&lt;/li&gt;&lt;li&gt;&lt;font face=&quot;Lucida Console&quot;&gt;B记录当前map的bucket数量对2取指数&lt;/font&gt;&lt;/li&gt;&lt;li&gt;&lt;font face=&quot;Lucida Console&quot;&gt;noverflow记录当前map中overflow bucket的数量&lt;/font&gt;&lt;/li&gt;&lt;li&gt;&lt;font face=&quot;Lucida Console&quot;&gt;hash0是map的hash因子&lt;/font&gt;&lt;/li&gt;&lt;li&gt;&lt;font face=&quot;Lucida Console&quot;&gt;buckets指向map的bucket数组&lt;/font&gt;&lt;/li&gt;&lt;li&gt;&lt;font face=&quot;Lucida Console&quot;&gt;oldbuckets指向map扩容前的buckets数组，仅在map正在进行扩容时有效&lt;/font&gt;&lt;/li&gt;&lt;li&gt;&lt;font face=&quot;Lucida Console&quot;&gt;nevacuate指示当前map扩容时，旧的buckets已完成迁移的bucket的偏移量&lt;/font&gt;&lt;/li&gt;&lt;/ul&gt;" style="rounded=0;whiteSpace=wrap;html=1;fontFamily=Lucida Console;fontSize=14;align=left;strokeColor=none;fillColor=none;" vertex="1" parent="1">
          <mxGeometry x="-310" y="40" width="310" height="240" as="geometry" />
        </mxCell>
        <mxCell id="uL5SlHfGoZUMoFEmo-0I-2" value="bucket" style="rounded=1;whiteSpace=wrap;html=1;fontSize=22;fontFamily=Lucida Console;fillColor=#f5f5f5;fontColor=#333333;strokeColor=#666666;labelPosition=right;verticalLabelPosition=middle;align=left;verticalAlign=middle;" vertex="1" parent="1">
          <mxGeometry x="670" y="40" width="360" height="420" as="geometry" />
        </mxCell>
        <mxCell id="uL5SlHfGoZUMoFEmo-0I-3" value="flags uint8" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fad9d5;strokeColor=#ae4132;fontSize=16;fontFamily=Lucida Console;" vertex="1" parent="1">
          <mxGeometry x="25" y="75" width="250" height="30" as="geometry" />
        </mxCell>
        <mxCell id="uL5SlHfGoZUMoFEmo-0I-4" value="B uint8" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fad9d5;strokeColor=#ae4132;fontSize=16;fontFamily=Lucida Console;" vertex="1" parent="1">
          <mxGeometry x="25" y="105" width="250" height="30" as="geometry" />
        </mxCell>
        <mxCell id="uL5SlHfGoZUMoFEmo-0I-5" value="noverflow uint16" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fad9d5;strokeColor=#ae4132;fontSize=16;fontFamily=Lucida Console;" vertex="1" parent="1">
          <mxGeometry x="25" y="135" width="250" height="30" as="geometry" />
        </mxCell>
        <mxCell id="uL5SlHfGoZUMoFEmo-0I-6" value="hash0 uint32" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fad9d5;strokeColor=#ae4132;fontSize=16;fontFamily=Lucida Console;" vertex="1" parent="1">
          <mxGeometry x="25" y="165" width="250" height="30" as="geometry" />
        </mxCell>
        <mxCell id="uL5SlHfGoZUMoFEmo-0I-7" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.25;entryDx=0;entryDy=0;fontFamily=Lucida Console;fontSize=22;fontColor=default;" edge="1" parent="1" source="uL5SlHfGoZUMoFEmo-0I-8" target="uL5SlHfGoZUMoFEmo-0I-2">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="uL5SlHfGoZUMoFEmo-0I-8" value="buckets unsafe.Pointer" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fad9d5;strokeColor=#ae4132;fontSize=16;fontFamily=Lucida Console;" vertex="1" parent="1">
          <mxGeometry x="25" y="195" width="250" height="30" as="geometry" />
        </mxCell>
        <mxCell id="uL5SlHfGoZUMoFEmo-0I-9" value="oldbuckets unsafe.Pointer" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fad9d5;strokeColor=#ae4132;fontSize=16;fontFamily=Lucida Console;" vertex="1" parent="1">
          <mxGeometry x="25" y="225" width="250" height="30" as="geometry" />
        </mxCell>
        <mxCell id="uL5SlHfGoZUMoFEmo-0I-10" value="nevacuate&amp;nbsp;uintptr" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fad9d5;strokeColor=#ae4132;fontSize=16;fontFamily=Lucida Console;" vertex="1" parent="1">
          <mxGeometry x="25" y="255" width="250" height="30" as="geometry" />
        </mxCell>
        <mxCell id="uL5SlHfGoZUMoFEmo-0I-11" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;fontFamily=Lucida Console;fontSize=16;" edge="1" parent="1" source="uL5SlHfGoZUMoFEmo-0I-12" target="uL5SlHfGoZUMoFEmo-0I-20">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="260" y="400" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="uL5SlHfGoZUMoFEmo-0I-12" value="extra&amp;nbsp;*mapextra" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fad9d5;strokeColor=#ae4132;fontSize=16;fontFamily=Lucida Console;" vertex="1" parent="1">
          <mxGeometry x="25" y="285" width="250" height="30" as="geometry" />
        </mxCell>
        <mxCell id="uL5SlHfGoZUMoFEmo-0I-13" value="overflow *[]*bmap" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fad9d5;strokeColor=#ae4132;fontSize=16;fontFamily=Lucida Console;" vertex="1" parent="1">
          <mxGeometry x="65" y="415" width="250" height="30" as="geometry" />
        </mxCell>
        <mxCell id="uL5SlHfGoZUMoFEmo-0I-14" value="oldoverflow *[]*bmap" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fad9d5;strokeColor=#ae4132;fontSize=16;fontFamily=Lucida Console;" vertex="1" parent="1">
          <mxGeometry x="65" y="445" width="250" height="30" as="geometry" />
        </mxCell>
        <mxCell id="uL5SlHfGoZUMoFEmo-0I-15" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.25;entryDx=0;entryDy=0;fontFamily=Lucida Console;fontSize=22;fontColor=default;" edge="1" parent="1" source="uL5SlHfGoZUMoFEmo-0I-16" target="uL5SlHfGoZUMoFEmo-0I-37">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="uL5SlHfGoZUMoFEmo-0I-16" value="nextOverflow *bmap" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fad9d5;strokeColor=#ae4132;fontSize=16;fontFamily=Lucida Console;" vertex="1" parent="1">
          <mxGeometry x="65" y="475" width="250" height="30" as="geometry" />
        </mxCell>
        <mxCell id="uL5SlHfGoZUMoFEmo-0I-17" value="tophash [bucketCnt]uint8" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fad9d5;strokeColor=#ae4132;fontSize=16;fontFamily=Lucida Console;" vertex="1" parent="1">
          <mxGeometry x="700" y="85" width="250" height="30" as="geometry" />
        </mxCell>
        <mxCell id="uL5SlHfGoZUMoFEmo-0I-18" value="count int" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fad9d5;strokeColor=#ae4132;fontSize=16;fontFamily=Lucida Console;" vertex="1" parent="1">
          <mxGeometry x="25" y="45" width="250" height="30" as="geometry" />
        </mxCell>
        <mxCell id="uL5SlHfGoZUMoFEmo-0I-19" value="hmap&lt;br style=&quot;font-size: 22px;&quot;&gt;" style="text;html=1;resizable=0;autosize=1;align=center;verticalAlign=middle;points=[];fillColor=none;strokeColor=none;rounded=0;labelBackgroundColor=none;labelBorderColor=none;fontFamily=Lucida Console;fontSize=22;fontColor=default;" vertex="1" parent="1">
          <mxGeometry x="110" y="5" width="80" height="40" as="geometry" />
        </mxCell>
        <mxCell id="uL5SlHfGoZUMoFEmo-0I-20" value="mapextra" style="text;html=1;resizable=0;autosize=1;align=center;verticalAlign=middle;points=[];fillColor=none;strokeColor=none;rounded=0;labelBackgroundColor=none;labelBorderColor=none;fontFamily=Lucida Console;fontSize=22;fontColor=default;" vertex="1" parent="1">
          <mxGeometry x="115" y="370" width="130" height="40" as="geometry" />
        </mxCell>
        <mxCell id="uL5SlHfGoZUMoFEmo-0I-21" value="bmap" style="text;html=1;resizable=0;autosize=1;align=center;verticalAlign=middle;points=[];fillColor=none;strokeColor=none;rounded=0;labelBackgroundColor=none;labelBorderColor=none;fontFamily=Lucida Console;fontSize=22;fontColor=default;" vertex="1" parent="1">
          <mxGeometry x="950" y="80" width="80" height="40" as="geometry" />
        </mxCell>
        <mxCell id="uL5SlHfGoZUMoFEmo-0I-22" value="key1" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FFE599;strokeColor=#ae4132;fontSize=16;fontFamily=Lucida Console;" vertex="1" parent="1">
          <mxGeometry x="700" y="115" width="250" height="30" as="geometry" />
        </mxCell>
        <mxCell id="uL5SlHfGoZUMoFEmo-0I-23" value="key2" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FFE599;strokeColor=#ae4132;fontSize=16;fontFamily=Lucida Console;" vertex="1" parent="1">
          <mxGeometry x="700" y="145" width="250" height="30" as="geometry" />
        </mxCell>
        <mxCell id="uL5SlHfGoZUMoFEmo-0I-24" value="..." style="text;html=1;resizable=0;autosize=1;align=center;verticalAlign=middle;points=[];fillColor=none;strokeColor=none;rounded=0;labelBackgroundColor=none;labelBorderColor=none;fontFamily=Lucida Console;fontSize=22;fontColor=default;rotation=90;" vertex="1" parent="1">
          <mxGeometry x="800" y="180" width="60" height="40" as="geometry" />
        </mxCell>
        <mxCell id="uL5SlHfGoZUMoFEmo-0I-25" value="key8" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FFE599;strokeColor=#ae4132;fontSize=16;fontFamily=Lucida Console;" vertex="1" parent="1">
          <mxGeometry x="700" y="230" width="250" height="30" as="geometry" />
        </mxCell>
        <mxCell id="uL5SlHfGoZUMoFEmo-0I-26" value="value1" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FFB570;strokeColor=#ae4132;fontSize=16;fontFamily=Lucida Console;" vertex="1" parent="1">
          <mxGeometry x="700" y="260" width="250" height="30" as="geometry" />
        </mxCell>
        <mxCell id="uL5SlHfGoZUMoFEmo-0I-27" value="value2" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FFB570;strokeColor=#ae4132;fontSize=16;fontFamily=Lucida Console;" vertex="1" parent="1">
          <mxGeometry x="700" y="290" width="250" height="30" as="geometry" />
        </mxCell>
        <mxCell id="uL5SlHfGoZUMoFEmo-0I-28" value="value8" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FFB570;strokeColor=#ae4132;fontSize=16;fontFamily=Lucida Console;" vertex="1" parent="1">
          <mxGeometry x="700" y="375" width="250" height="30" as="geometry" />
        </mxCell>
        <mxCell id="uL5SlHfGoZUMoFEmo-0I-29" value="overflow *bmap" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fad9d5;strokeColor=#ae4132;fontSize=16;fontFamily=Lucida Console;" vertex="1" parent="1">
          <mxGeometry x="700" y="405" width="250" height="30" as="geometry" />
        </mxCell>
        <mxCell id="uL5SlHfGoZUMoFEmo-0I-30" value="..." style="text;html=1;resizable=0;autosize=1;align=center;verticalAlign=middle;points=[];fillColor=none;strokeColor=none;rounded=0;labelBackgroundColor=none;labelBorderColor=none;fontFamily=Lucida Console;fontSize=22;fontColor=default;rotation=90;" vertex="1" parent="1">
          <mxGeometry x="800" y="330" width="60" height="40" as="geometry" />
        </mxCell>
        <mxCell id="uL5SlHfGoZUMoFEmo-0I-31" value="bucket" style="rounded=1;whiteSpace=wrap;html=1;fontSize=22;fontFamily=Lucida Console;fillColor=#f5f5f5;fontColor=#333333;strokeColor=#666666;labelPosition=right;verticalLabelPosition=middle;align=left;verticalAlign=middle;" vertex="1" parent="1">
          <mxGeometry x="670" y="460" width="360" height="190" as="geometry" />
        </mxCell>
        <mxCell id="uL5SlHfGoZUMoFEmo-0I-32" value="tophash [bucketCnt]uint8" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fad9d5;strokeColor=#ae4132;fontSize=16;fontFamily=Lucida Console;" vertex="1" parent="1">
          <mxGeometry x="700" y="505" width="250" height="30" as="geometry" />
        </mxCell>
        <mxCell id="uL5SlHfGoZUMoFEmo-0I-33" value="bmap" style="text;html=1;resizable=0;autosize=1;align=center;verticalAlign=middle;points=[];fillColor=none;strokeColor=none;rounded=0;labelBackgroundColor=none;labelBorderColor=none;fontFamily=Lucida Console;fontSize=22;fontColor=default;" vertex="1" parent="1">
          <mxGeometry x="950" y="500" width="80" height="40" as="geometry" />
        </mxCell>
        <mxCell id="uL5SlHfGoZUMoFEmo-0I-34" value="overflow *bmap" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fad9d5;strokeColor=#ae4132;fontSize=16;fontFamily=Lucida Console;" vertex="1" parent="1">
          <mxGeometry x="700" y="605" width="250" height="30" as="geometry" />
        </mxCell>
        <mxCell id="uL5SlHfGoZUMoFEmo-0I-35" value="..." style="text;html=1;resizable=0;autosize=1;align=center;verticalAlign=middle;points=[];fillColor=none;strokeColor=none;rounded=0;labelBackgroundColor=none;labelBorderColor=none;fontFamily=Lucida Console;fontSize=22;fontColor=default;rotation=90;" vertex="1" parent="1">
          <mxGeometry x="800" y="545" width="60" height="40" as="geometry" />
        </mxCell>
        <mxCell id="uL5SlHfGoZUMoFEmo-0I-36" value="..." style="text;html=1;resizable=0;autosize=1;align=center;verticalAlign=middle;points=[];fillColor=none;strokeColor=none;rounded=0;labelBackgroundColor=none;labelBorderColor=none;fontFamily=Lucida Console;fontSize=22;fontColor=default;rotation=90;" vertex="1" parent="1">
          <mxGeometry x="800" y="660" width="60" height="40" as="geometry" />
        </mxCell>
        <mxCell id="uL5SlHfGoZUMoFEmo-0I-37" value="bucket" style="rounded=1;whiteSpace=wrap;html=1;fontSize=22;fontFamily=Lucida Console;fillColor=#f5f5f5;fontColor=#333333;strokeColor=#666666;labelPosition=right;verticalLabelPosition=middle;align=left;verticalAlign=middle;" vertex="1" parent="1">
          <mxGeometry x="670" y="720" width="360" height="190" as="geometry" />
        </mxCell>
        <mxCell id="uL5SlHfGoZUMoFEmo-0I-38" value="tophash [bucketCnt]uint8" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fad9d5;strokeColor=#ae4132;fontSize=16;fontFamily=Lucida Console;" vertex="1" parent="1">
          <mxGeometry x="700" y="765" width="250" height="30" as="geometry" />
        </mxCell>
        <mxCell id="uL5SlHfGoZUMoFEmo-0I-39" value="bmap" style="text;html=1;resizable=0;autosize=1;align=center;verticalAlign=middle;points=[];fillColor=none;strokeColor=none;rounded=0;labelBackgroundColor=none;labelBorderColor=none;fontFamily=Lucida Console;fontSize=22;fontColor=default;" vertex="1" parent="1">
          <mxGeometry x="950" y="760" width="80" height="40" as="geometry" />
        </mxCell>
        <mxCell id="uL5SlHfGoZUMoFEmo-0I-40" value="overflow *bmap" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fad9d5;strokeColor=#ae4132;fontSize=16;fontFamily=Lucida Console;" vertex="1" parent="1">
          <mxGeometry x="700" y="865" width="250" height="30" as="geometry" />
        </mxCell>
        <mxCell id="uL5SlHfGoZUMoFEmo-0I-41" value="..." style="text;html=1;resizable=0;autosize=1;align=center;verticalAlign=middle;points=[];fillColor=none;strokeColor=none;rounded=0;labelBackgroundColor=none;labelBorderColor=none;fontFamily=Lucida Console;fontSize=22;fontColor=default;rotation=90;" vertex="1" parent="1">
          <mxGeometry x="800" y="805" width="60" height="40" as="geometry" />
        </mxCell>
        <mxCell id="uL5SlHfGoZUMoFEmo-0I-42" value="bucket" style="rounded=1;whiteSpace=wrap;html=1;fontSize=22;fontFamily=Lucida Console;fillColor=#f5f5f5;fontColor=#333333;strokeColor=#666666;labelPosition=right;verticalLabelPosition=middle;align=left;verticalAlign=middle;" vertex="1" parent="1">
          <mxGeometry x="670" y="970" width="360" height="190" as="geometry" />
        </mxCell>
        <mxCell id="uL5SlHfGoZUMoFEmo-0I-43" value="tophash [bucketCnt]uint8" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fad9d5;strokeColor=#ae4132;fontSize=16;fontFamily=Lucida Console;" vertex="1" parent="1">
          <mxGeometry x="700" y="1015" width="250" height="30" as="geometry" />
        </mxCell>
        <mxCell id="uL5SlHfGoZUMoFEmo-0I-44" value="bmap" style="text;html=1;resizable=0;autosize=1;align=center;verticalAlign=middle;points=[];fillColor=none;strokeColor=none;rounded=0;labelBackgroundColor=none;labelBorderColor=none;fontFamily=Lucida Console;fontSize=22;fontColor=default;" vertex="1" parent="1">
          <mxGeometry x="950" y="1010" width="80" height="40" as="geometry" />
        </mxCell>
        <mxCell id="uL5SlHfGoZUMoFEmo-0I-45" value="overflow *bmap" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fad9d5;strokeColor=#ae4132;fontSize=16;fontFamily=Lucida Console;" vertex="1" parent="1">
          <mxGeometry x="700" y="1115" width="250" height="30" as="geometry" />
        </mxCell>
        <mxCell id="uL5SlHfGoZUMoFEmo-0I-46" value="..." style="text;html=1;resizable=0;autosize=1;align=center;verticalAlign=middle;points=[];fillColor=none;strokeColor=none;rounded=0;labelBackgroundColor=none;labelBorderColor=none;fontFamily=Lucida Console;fontSize=22;fontColor=default;rotation=90;" vertex="1" parent="1">
          <mxGeometry x="800" y="1055" width="60" height="40" as="geometry" />
        </mxCell>
        <mxCell id="uL5SlHfGoZUMoFEmo-0I-47" value="..." style="text;html=1;resizable=0;autosize=1;align=center;verticalAlign=middle;points=[];fillColor=none;strokeColor=none;rounded=0;labelBackgroundColor=none;labelBorderColor=none;fontFamily=Lucida Console;fontSize=22;fontColor=default;rotation=90;" vertex="1" parent="1">
          <mxGeometry x="800" y="920" width="60" height="40" as="geometry" />
        </mxCell>
        <mxCell id="uL5SlHfGoZUMoFEmo-0I-48" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=1;entryY=0.25;entryDx=0;entryDy=0;fontFamily=Lucida Console;fontSize=22;fontColor=default;" edge="1" parent="1" source="uL5SlHfGoZUMoFEmo-0I-45" target="uL5SlHfGoZUMoFEmo-0I-2">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1180" y="1140" />
              <mxPoint x="1180" y="145" />
            </Array>
            <mxPoint x="950" y="1810" as="sourcePoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="uL5SlHfGoZUMoFEmo-0I-49" value="&lt;ul style=&quot;font-family: Helvetica;&quot;&gt;&lt;li&gt;&lt;font face=&quot;Lucida Console&quot;&gt;overflow和oldoverflow用于在map不含指针类型数据的时候，分别记录了map的overflow bucket数组和扩容时数据迁移前的overflow bucket数组，用于辅助GC进行内存释放&lt;/font&gt;&lt;/li&gt;&lt;li&gt;nextOverflow指向了在map初始化或者扩容新分配内存时，根据bucket的数量，可能会提前分配一定数量的overflow bucket，以备当map元素增加，需要分配overflow bucket时可以快速拿这里面提前分配好的overflow bucket进行使用，减少map写入操作时可能的overflow bucket分配开销&lt;/li&gt;&lt;/ul&gt;" style="rounded=0;whiteSpace=wrap;html=1;fontFamily=Lucida Console;fontSize=14;align=left;strokeColor=none;fillColor=none;" vertex="1" parent="1">
          <mxGeometry x="-295" y="355" width="320" height="230" as="geometry" />
        </mxCell>
        <mxCell id="uL5SlHfGoZUMoFEmo-0I-50" value="&lt;div&gt;bucket是map存储真实数据的内存区域&lt;/div&gt;&lt;div&gt;&lt;ul&gt;&lt;li&gt;每个bucket头部都有一个8个元素的tophash数组，该数组元素用于记录该元素对应index位置的cell的key经过hash后的头8位，特殊情况下还可以用来指示该cell的状态，如是否为空;扩容时迁移到上半区还是下半区等&lt;/li&gt;&lt;li&gt;tophash数据后面的内存区域，按照key1~key8，value1~value8的顺序，存放了8组kv对，用于存储map的真实数据&lt;/li&gt;&lt;li&gt;在kv对最后，存储了一个指针，用于指向该bucket可能存在的对应的overflow bucket，overflow bucket用于当bucket的8组kv对都使用完毕后，新的数据的存储。可以看到一个bucket的overflowbucket全部使用这种方式以相当于链表的形式链接起来&lt;/li&gt;&lt;/ul&gt;&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;fontFamily=Lucida Console;fontSize=14;align=left;strokeColor=none;fillColor=none;" vertex="1" parent="1">
          <mxGeometry x="1160" y="15" width="310" height="315" as="geometry" />
        </mxCell>
        <mxCell id="uL5SlHfGoZUMoFEmo-0I-51" value="&lt;div&gt;map读写的大致过程&lt;/div&gt;&lt;div&gt;&lt;ul&gt;&lt;li&gt;当对map进行特定的key查找时，首先通过hash函数计算出该key对应的bucket。然后遍历该bucket和该bucket对应的所有overflow bucket，找到存储的元素中，tophash对应的元素与key计算出来的hash值top 8位相等且找到的元素key与要查找的target key相等的元素，然后返回该元素对应的value&lt;/li&gt;&lt;li&gt;当对map进行写入时，也与上述读过程类似。如果在上述查找过程中找到key对应的value，则更新之；若没有找到，则证明该key还没有写入过，因此需要在对应的bucket或者overflow bucket(若需要甚至可能需要分配新的overflow bucket)中找到合适位置将新的kv对写入&lt;/li&gt;&lt;/ul&gt;&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;fontFamily=Lucida Console;fontSize=14;align=left;strokeColor=none;fillColor=none;" vertex="1" parent="1">
          <mxGeometry x="50" y="585" width="310" height="315" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
